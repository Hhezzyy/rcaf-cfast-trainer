diff --git a/cfast_trainer/math_ui.py b/cfast_trainer/math_ui.py
--- a/cfast_trainer/math_ui.py
+++ b/cfast_trainer/math_ui.py
@@
 from __future__ import annotations
 
-import pygame
 from dataclasses import dataclass
-from typing import Optional
+from typing import Optional, Protocol
 
-from .app import App, Screen
+import pygame
 
 from .math_core import MathProblem, MathProblemGenerator, MathTestEngine
 
 
+class AppLike(Protocol):
+    @property
+    def font(self) -> pygame.font.Font: ...
+
+    def pop(self) -> None: ...
+
+
 @dataclass
 class _PracticeState:
@@
-    current_problem: Optional[int] = None
+    current_problem: Optional[MathProblem] = None
@@
 class MathTestScreen:
@@
-    def __init__(self, app: App) -> None:
+    def __init__(self, app: AppLike) -> None:
         self._app = app
         self._state = "instructions"
         self._input_text = ""
diff --git a/tests/test_math_core.py b/tests/test_math_core.py
--- a/tests/test_math_core.py
+++ b/tests/test_math_core.py
@@
 def test_headless_simulation() -> None:
@@
     while not engine.finished:
         problem = engine.current_problem
         assert problem is not None
         # Always answer correctly
         clock.advance(0.5)
+        if engine.finished:
+            break
         engine.submit_answer(problem.answer)
         answers_given += 1
     summary = engine.summary()
     # All answers should be correct
     assert summary['attempted'] == answers_given
     assert summary['correct'] == answers_given
